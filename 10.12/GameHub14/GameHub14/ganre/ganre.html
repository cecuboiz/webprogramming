<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì¥ë¥´ë³„ ê²Œì„ | GameHub</title>
  <!-- ìƒìœ„ í´ë”ì˜ style.css ì°¸ì¡° -->
  <link rel="stylesheet" href="ganre.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.min.css">
</head>
<body class="search-page">
  <header class="navbar">
    <div class="logo" onclick="location.href='../index.html'">
      <i class="ri-game-fill"></i>
      <p>GameHub</p>
    </div>
    <div class="nav-buttons">
      <button onclick="location.href='../index.html'">ğŸ  í™ˆìœ¼ë¡œ</button>
    </div>
  </header>

  <main class="hero">
    <h1 class="title" id="genreTitle">ğŸ® ì¥ë¥´ë³„ ê²Œì„</h1>
    <p class="subtitle" id="genreSubtitle">ì„ íƒí•œ ì¥ë¥´ì˜ ê²Œì„ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
  </main>

  <section id="genreResults" class="results">
    <div class="results-grid" id="resultsGrid"></div>
    <p class="results-empty hidden" id="resultsEmpty">í•´ë‹¹ ì¥ë¥´ì˜ ê²Œì„ì´ ì—†ì–´ìš” ğŸ˜…</p>
  </section>

  <!-- ìƒìœ„ í´ë”ì˜ script.js ì°¸ì¡° -->
  <script src="../script.js"></script>
  <script>
  window.addEventListener("load", () => {
    const params = new URLSearchParams(window.location.search);
    const genre = params.get("genre");
    const titleEl = document.getElementById("genreTitle");
    const subEl = document.getElementById("genreSubtitle");

    if (genre) {
      titleEl.textContent = `ğŸ¯ ${genre} ì¥ë¥´ ê²Œì„`;
      subEl.textContent = `${genre} ì¥ë¥´ì˜ ì¸ê¸° ê²Œì„ì„ ë§Œë‚˜ë³´ì„¸ìš”.`;
      showGenreGames(genre);
    }
  });

  function showGenreGames(genre) {
  const games = JSON.parse(localStorage.getItem("games") || "[]");
  const normalized = genre.toLowerCase();

  // âœ… ì¥ë¥´ í•„í„° (ë°°ì—´/ë¬¸ìì—´ ëª¨ë‘ ì§€ì›)
  let filtered;

if (genre === "ì „ì²´") {
  // âœ… ì „ì²´ ë³´ê¸° ì„ íƒ ì‹œ ëª¨ë“  ê²Œì„ ë³´ì—¬ì£¼ê¸°
  filtered = games;
} else {
  const normalized = genre.toLowerCase();
  filtered = games.filter(g => {
    const genres = Array.isArray(g.genres)
      ? g.genres
      : (g.genre ? [g.genre] : []);
    return (
      genres.some(val => val?.toLowerCase?.() === normalized) ||
      (g.tags || []).some(t => t?.toLowerCase?.() === normalized)
    );
  });
}



  const grid = document.getElementById("resultsGrid");
  const empty = document.getElementById("resultsEmpty");
  grid.innerHTML = "";

  if (!filtered.length) {
    empty.classList.remove("hidden");
    return;
  }
  empty.classList.add("hidden");

  // ê²€ìƒ‰ ì¹´ë“œ ìŠ¤íƒ€ì¼ì²˜ëŸ¼ ë Œë”
  const fmt = (n) => n?.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

  filtered.forEach(g => {
    const card = document.createElement("article");
    card.className = "gh-card";

    // âœ… ì´ë¯¸ì§€: base64(g.image) â†’ URL(g.cover)
    const imageSrc = g.image || g.cover || "";
    const finalImageSrc = imageSrc.startsWith("Images/") ? `../${imageSrc}` : imageSrc;

    const cover = finalImageSrc
      ? `<img src="${finalImageSrc}" alt="${g.title} ì»¤ë²„ ì´ë¯¸ì§€" />`
      : "";
    
    card.innerHTML = `
      <div class="gh-thumb">
        ${cover}
        <div class="gh-thumb-overlay"></div>
        ${!cover ? `<div class="gh-thumb-placeholder" aria-hidden="true"></div>` : ""}
      </div>

      <div class="gh-body">
        <h3 class="gh-title">${g.title}</h3>
        <p class="gh-meta">${g.studio || "-"} Â· ${g.year || "-"}</p>

        <div class="gh-badges">
          <span class="badge">${Array.isArray(g.genres) ? g.genres[0] : g.genre || "-"}</span>
          ${(g.tags || []).slice(0, 2).map(t => `<span class="badge badge-ghost">${t}</span>`).join("")}
        </div>

        <p class="gh-desc">${g.desc || ""}</p>

        <p class="gh-author">ë“±ë¡ì: ${getUserNameByEmail(g.creator)}</p>
        
        <div class="gh-stats">
          <span class="star" title="í‰ì ">${g.rating?.toFixed ? g.rating.toFixed(1) : (g.rating || "-")}</span>
          <span class="likes" title="ì¢‹ì•„ìš” ìˆ˜">${fmt(g.likes || 0)}</span>
        </div>

        <div class="gh-actions">
          <button class="btn btn-ghost">ğŸ‘ ì¶”ì²œí•˜ê¸°</button>
          <a class="btn btn-outline" href="../game/game.html?id=${g.id}">ğŸ‘ï¸ ìì„¸íˆ</a>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
}
  
</script>
</body>
</html>